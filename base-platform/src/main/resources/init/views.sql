drop table view_user:create or replace view view_user as select org.data_code org_Data_Code,ui.data_code user_data_code,su.code sys_user_code,ui.position,ui.code,ui.name,su.account,su.state,org.code org_code,org.name org_name from sys_user su left join USER_BASE_INFO ui on su.code=ui.ref_account left join organization_info org on  ui.org_code=org.code  where nvl(org.version_id,0)=0 and nvl(su.version_id,0)=0 and nvl(ui.version_id,0)=0
drop table view_user_role:create or replace view view_user_role as select  su.ACCOUNT,sr.code role_code,sr.name role_name,sr.remark role_remark from sys_user su  join sys_user_role sur on su.code=sur.sys_user_code  join sys_role sr on sur.role_code=sr.data_code where su.version_id=0 and sur.version_id=0 and sr.version_id=0 and sr.code<>'normal' union select  su.ACCOUNT,'normal' role_code,'普通人员' role_name,'普通人员' role_remark from sys_user su
drop table view_menu_role:CREATE OR REPLACE VIEW VIEW_MENU_ROLE AS SELECT sm.code, sm.name, sm.sort, sm.parent_code, sm.url, nvl(sr.code, 'normal') role_code, nvl(sr.name, '普通人员') role_name, nvl(sr.remark, '普通人员') role_remark FROM sys_menu sm LEFT JOIN sys_role_menu srm ON sm.code = srm.menu_code LEFT JOIN sys_role sr ON srm.role_code = sr.code left join(SELECT code,connect_by_isleaf FROM sys_menu m WHERE m.version_id = 0 start WITH m.parent_code is null connect by m.parent_code = prior m.code) mm on sm.code=mm.code left join (SELECT code FROM sys_menu m WHERE m.version_id = 0 start WITH m.code = 'systemManager' connect by m.parent_code = prior m.code) mk ON sm.code = mk.code WHERE nvl(sm.version_id, 0) = 0 AND nvl(srm.version_id, 0) = 0 AND nvl(sr.version_id, 0) = 0 AND mm.connect_by_isleaf = 1 AND nvl(sr.code, '_NO_ROLE_DATA') <> 'sysAdmin' AND nvl(sr.code, '_NO_ROLE_DATA') <> 'normal' AND mk.code is null UNION SELECT sm.code, sm.name, sm.sort, sm.parent_code, sm.url, 'sysAdmin' role_code, '系统管理员' role_name, '系统管理员' role_remark FROM sys_menu sm left join (SELECT code,connect_by_isleaf FROM sys_menu m WHERE m.version_id = 0 start WITH m.parent_code is null connect by m.parent_code = prior m.code) mm on sm.code=mm.code WHERE mm.connect_by_isleaf = 1
drop table view_user_menu:CREATE OR REPLACE VIEW VIEW_USER_MENU AS SELECT distinct vur.ACCOUNT,sm.icon AS  menu_icon, sm.code AS menu_code, sm.name AS menu_name, sm.sort AS menu_sort, sm.url AS menu_url, sm.parent_code AS menu_parent_code FROM view_user_role vur JOIN view_menu_role vmr ON vur.role_code = vmr.role_code join( select sy.code,sys_connect_by_path (sy.code, ',') menu_path from sys_menu sy where version_id=0 and connect_by_isleaf=1 start with sy.parent_code is null connect by sy.parent_code= prior sy.code) t on t.code=vmr.code join sys_menu sm on sm.code in( select regexp_substr(t.menu_path,'[^,]+',1,rownum) from dual connect by rownum<=length(t.menu_path)-length(replace(t.menu_path,','))+1 ) where sm.version_id=0